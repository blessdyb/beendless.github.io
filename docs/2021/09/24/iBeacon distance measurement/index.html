<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Move Fast, Live Happily, With No End"><title>iBeacon distance measurement | Beendless ~ 快节奏,慢生活,无止境</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-38171545-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-38171545-1');</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-56NRL5V');</script><script>(function(h,o,t,j,a,r){
    h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
    h._hjSettings={hjid:3218463,hjsv:6};
    a=o.getElementsByTagName('head')[0];
    r=o.createElement('script');r.async=1;
    r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
    a.appendChild(r);
})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iBeacon distance measurement</h1><a id="logo" href="/.">Beendless ~ 快节奏,慢生活,无止境</a><p class="description">Move Fast, Live Happily, With No End</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">iBeacon distance measurement</h1><div class="post-meta">2021-09-24<span> | </span><span class="category"><a href="/categories/CS/">CS</a></span></div><div class="post-content"><p>Bluetooth technology has been widely used in various devices, such as earphones, speakers, smart watches and so on. One of the important applications is Bluetooth positioning technology, which can determine the distance between devices by measuring the strength of Bluetooth signals. This method of distance estimation based on signal strength is called RSSI (Received Signal Strength Indication) ranging. In this article, we will discuss the principle, implementation, and related application scenarios of RSSI ranging.</p>
<p>RSSI ranging is a method of distance estimation by measuring the received signal strength indication (RSSI) of the Bluetooth signal. Generally speaking, the closer the distance between two devices, the greater the Bluetooth signal strength between them. Therefore, we can infer the distance between devices by measuring the change in this signal strength.<br>Specifically, when one device sends a Bluetooth signal, the other device receives this signal and uses the strength of the received signal to estimate the distance between them. Ideally, there is an inverse proportional relationship between the strength of the Bluetooth signal and the distance. That is, as the distance between two devices increases, the signal strength between them decreases, and vice versa.</p>
<p>In the process of RSSI ranging, we usually use the following formula to express the relationship between signal strength and distance：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">RSSI</span> = A - 10nlog(d)</span><br></pre></td></tr></table></figure>

<p>Among them, RSSI represents the received signal strength, A represents the reference signal strength at 1 meter, n represents the environmental attenuation factor, and d represents the distance between devices. This formula can help us estimate the distance between two devices, so as to realize the positioning and distance measurement based on Bluetooth technology.<br>Although the RSSI ranging formula seems simple, there are some problems in practical applications. Chief among them is the effect of environmental changes on signal strength. Since Bluetooth signals are susceptible to interference from walls, furniture, and other objects, the distance between devices is not always inversely proportional to signal strength.<br>For example, in a closed room, the signal strength between two devices may be more susceptible to interference than in an open, empty area, even if the distance between the two is the same. In this case, there may be errors in calculating the distance using the RSSI formula.<br>Additionally, the device itself can have an impact on signal strength. For example, different models or different brands of equipment may emit signals of different strengths, resulting in deviations in RSSI ranging.<br>In order to solve the above problems, various methods can be adopted to optimize the accuracy of RSSI ranging. For example, using multiple antennas to receive a signal, averaging RSSI values, using a Kalman filter, etc. These methods can help us eliminate the influence of signal strength changes, thereby improving the accuracy and reliability of RSSI ranging,<br>Here is a simple example of implementing RSSI ranging and Kalman filtering in Javascript:</p>
<pre><code>function calculateDistance(rssi) &#123;
  var txPower = -59; 
  var n = 2.0;
  return Math.pow(10, (txPower - rssi) / (10 * n));
&#125;

function KalmanFilter() &#123;
  this.Q = 0.01; 
  this.R = 0.1; 
  this.x = 0; 
  this.P = 1; 

  this.update = function(z) &#123;
    var x_pred = this.x;
    var P_pred = this.P + this.Q;

    var K = P_pred / (P_pred + this.R);
    this.x = x_pred + K * (z - x_pred);
    this.P = (1 - K) * P_pred;
    return this.x;
  &#125;
&#125;

var rssiValues = [-70, -75, -80, -85, -90];
var distances = [];

var kf = new KalmanFilter();
for (var i = 0; i &lt; rssiValues.length; i++) &#123;
  var distance = calculateDistance(rssiValues[i]);
  var filteredDistance = kf.update(distance);
  distances.push(filteredDistance);
&#125;

console.log(distances);
</code></pre>
<p>Calculates the distance between devices based on signal strength. Then, we implement a class KalmanFilter() of a Kalman filter, through which the measured values are smoothed and optimized.<br>Finally, in the test data, we simulate a set of RSSI signal strength values, and use the above two methods to calculate the distance corresponding to each signal, and perform Kalman filter optimization on the distance value. The final output is a filtered optimized distance array.<br>It should be noted that this is just a simple sample code, and more factors need to be considered in actual application, such as signal sampling rate, filter parameter adjustment, etc.<br>Another thing to note is that this method is not as accurate as we think it can’t accurately distinguish between 1.1 or 1.2 meters of distance difference. As the distance increases, the estimated distance becomes less and less accurate.<br>Secondly, when the real distance is 2 meters, the calculated distance estimate may fluctuate around 2 meters, and the error range has doubled. As the distance increases, the error margin will continue to increase. Ultimately, the distance estimation has little accuracy at distances beyond 10 meters.<br>This is because the Bluetooth signal will gradually attenuate during transmission, and the Bluetooth transceiver itself is also a weak signal transmitter, and the maximum distance that can be sent is usually about 100 meters. Before reaching that distance, the signal becomes so weak that it is barely detectable, and at a distance of 30 meters the signal level also drops to about -100 dBm. This is usually the weakest signal level the receiver can hear. At 40 meters, the receiver won’t be able to pick up most packets because the signal is so weak it’s almost indistinguishable from background radio noise. So even if the receiver is able to receive the packet, it is only lucky to hear part of it.<br>Finally, since the signal strength looks almost the same in the receiver, the distance estimation simply cannot distinguish between a transmitter at 30 meters and a distance of 40 meters. In both cases, the signal strength is similarly weak, so we cannot accurately distinguish the distance difference between them by RSSI ranging method.<br>RSSI fingerprinting is an alternative technique. It builds a fingerprint map based on the Wi-Fi, Bluetooth and other wireless signal strength information data collected in advance, and determines the user’s location by comparing the signal strength of the current location with the data in the fingerprint map to match.<br>This method requires the following steps：</p>
<ul>
<li>Collect Wi-Fi and Bluetooth signal strength data in the area to be located, and generate a fingerprint database.</li>
<li>Obtain the signal strength of the current location through Bluetooth scanning, and compare it with the signal strength in the fingerprint database.</li>
<li>Determine the current location according to the degree of matching, usually using the nearest neighbor method (nearest neighbor) or cross-validation method (cross-validation) to select the optimal matching algorithm.</li>
</ul>
<p>The following is a simple code snippet to show how to implement Bluetooth RSSI-based fingerprinting using Python:</p>
<pre><code>import math
import pandas as pd


def calculate_distance(x1, y1, x2, y2):
   return math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2)

fingerprint_db = pd.read_csv(&#39;fingerprint_database.csv&#39;)

current_rssi = -75

min_distance = float(&#39;inf&#39;)
location = &#39;&#39;
for index, row in fingerprint_db.iterrows():
   distance = calculate_distance(row[&#39;x&#39;], row[&#39;y&#39;], current_x, current_y)
   if distance &lt; min_distance:
       min_distance = distance
       location = row[&#39;location&#39;]
       
print(&#39;Current location:&#39;, location)
</code></pre>
</div><div class="tags"><a href="/tags/Bluetooth/"><i class="fa fa-tag"></i>Bluetooth</a><a href="/tags/GEO-Location/"><i class="fa fa-tag"></i>GEO Location</a></div><div class="post-nav"><a class="pre" href="/2021/09/27/Search%20in%20Trees/">Search in Trees</a><a class="next" href="/2021/09/23/Construct-and-Update-a-Tree/">Construct and Update a Tree</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.beendless.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CS/">CS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recipe/">Recipe</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%B2%E6%BD%AE%EF%B9%A3%E9%80%80%E6%BD%AE/">漲潮﹣退潮</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%84%A1%E7%9F%A5%EF%B9%A3%E6%97%A0%E7%9F%A5/">無知﹣无知</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%A1%8C%E8%B5%B0%E7%9A%84%E6%A8%B9%E8%8B%97/">行走的樹苗</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Machine-Learning/" style="font-size: 15px;">Machine Learning</a> <a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/Algorithms/" style="font-size: 15px;">Algorithms</a> <a href="/tags/Leetcode/" style="font-size: 15px;">Leetcode</a> <a href="/tags/Backtracking/" style="font-size: 15px;">Backtracking</a> <a href="/tags/Subsets/" style="font-size: 15px;">Subsets</a> <a href="/tags/Binary-Search/" style="font-size: 15px;">Binary Search</a> <a href="/tags/Array/" style="font-size: 15px;">Array</a> <a href="/tags/HashMap/" style="font-size: 15px;">HashMap</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Async/" style="font-size: 15px;">Async</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/CNN/" style="font-size: 15px;">CNN</a> <a href="/tags/Deep-Learning-with-TensorFlow-2-and-Keras/" style="font-size: 15px;">Deep Learning with TensorFlow 2 and Keras</a> <a href="/tags/Binary-Tree/" style="font-size: 15px;">Binary Tree</a> <a href="/tags/Queue/" style="font-size: 15px;">Queue</a> <a href="/tags/Stack/" style="font-size: 15px;">Stack</a> <a href="/tags/Linked-List/" style="font-size: 15px;">Linked List</a> <a href="/tags/Dynamic-Programming/" style="font-size: 15px;">Dynamic Programming</a> <a href="/tags/DFS/" style="font-size: 15px;">DFS</a> <a href="/tags/Knapsack/" style="font-size: 15px;">Knapsack</a> <a href="/tags/Two-Pointers/" style="font-size: 15px;">Two Pointers</a> <a href="/tags/Greedy/" style="font-size: 15px;">Greedy</a> <a href="/tags/Bucket-Sort/" style="font-size: 15px;">Bucket Sort</a> <a href="/tags/Top-K-Frequent/" style="font-size: 15px;">Top K Frequent</a> <a href="/tags/Heap/" style="font-size: 15px;">Heap</a> <a href="/tags/Priority-Queue/" style="font-size: 15px;">Priority Queue</a> <a href="/tags/Functional-Programming/" style="font-size: 15px;">Functional Programming</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/JumpGame/" style="font-size: 15px;">JumpGame</a> <a href="/tags/BFS/" style="font-size: 15px;">BFS</a> <a href="/tags/Sliding-Window/" style="font-size: 15px;">Sliding Window</a> <a href="/tags/Google-Colab/" style="font-size: 15px;">Google Colab</a> <a href="/tags/Mastering-Go/" style="font-size: 15px;">Mastering Go</a> <a href="/tags/Chinese-Food/" style="font-size: 15px;">Chinese Food</a> <a href="/tags/Monotonic-Stack/" style="font-size: 15px;">Monotonic Stack</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/DevOps/" style="font-size: 15px;">DevOps</a> <a href="/tags/NodeJS/" style="font-size: 15px;">NodeJS</a> <a href="/tags/Archetecture/" style="font-size: 15px;">Archetecture</a> <a href="/tags/AWS/" style="font-size: 15px;">AWS</a> <a href="/tags/Deep-Learning/" style="font-size: 15px;">Deep Learning</a> <a href="/tags/ConvnetJS/" style="font-size: 15px;">ConvnetJS</a> <a href="/tags/Stock-Exchange/" style="font-size: 15px;">Stock Exchange</a> <a href="/tags/Matrix/" style="font-size: 15px;">Matrix</a> <a href="/tags/String/" style="font-size: 15px;">String</a> <a href="/tags/KMP/" style="font-size: 15px;">KMP</a> <a href="/tags/Time-complexity/" style="font-size: 15px;">Time complexity</a> <a href="/tags/Bluetooth/" style="font-size: 15px;">Bluetooth</a> <a href="/tags/GEO-Location/" style="font-size: 15px;">GEO Location</a> <a href="/tags/WebSocket/" style="font-size: 15px;">WebSocket</a> <a href="/tags/HttpProxy/" style="font-size: 15px;">HttpProxy</a> <a href="/tags/FFMPEG/" style="font-size: 15px;">FFMPEG</a> <a href="/tags/Rust/" style="font-size: 15px;">Rust</a> <a href="/tags/WASM/" style="font-size: 15px;">WASM</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/08/02/Build%20Your%20Own%20Video%20Compression%20Service%20with%20Rust%20WASM/">Build Your Own Video Compression Service with Rust WASM</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/08/01/The%20Secret%20of%20Video%20Compression%20with%20FFMPEG/">The Secret of Video Compression with FFMPEG</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/07/17/NodeJS%20Http-Proxy%20with%20WebSocket/">NodeJS Http-Proxy with WebSocket</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/11/15/Set%20up%20Kubeadm%20on%20Macbook%20with%20Vagrant/">Set up Kubeadm on MacOS with Vagrant and VirtualBox</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/26/Ma-Po%20Tofu/">MMM, Ma-Po Tofu !</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/19/Multi-Stage%20Golang%20Docker%20Image/">Multi-Stage Golang Docker Image Build and Kubernetes Deployment</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/18/Mastering%20Go%20Notes/">Mastering Go Notes</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/16/Monotonic%20Stack/">Monotonic Stack</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/15/Indoor%20bluetooth%20location/">Indoor bluetooth location</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/14/Dynamic%20Programming%20IV/">Dynamic Programming IV</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">Beendless ~ 快节奏,慢生活,无止境.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>